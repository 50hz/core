<!--

The `fin-hypergrid-column-resizing` element is a custom Polymer web component that serves as the base "class" or API for the grid features (controllers).

@group OpenFin hypergrid
@element fin-hypergrid-column-resizing
@homepage http://github.com/openfin/fin-hypergrid
-->

<polymer-element name="fin-hypergrid-feature-column-resizing" extends="fin-hypergrid-feature-base">
  <template></template>
  <script>


(function() {

'use strict';

    Polymer({ /* jshint ignore:line */

        dragColumn: -1,
        dragStart: -1,
        dragColumnStartingWidth: -1,

        handleMouseDrag: function(grid, event) {
            if (this.dragColumn > -1) {
                var fixedColumnCount = grid.getFixedColumnCount();
                var distance = event.primitiveEvent.detail.mouse.x - this.dragStart + this.dragColumnStartingWidth;
                this.setColumnWidth(grid, this.dragColumn - fixedColumnCount - 1, distance);
            } else if (this.next) {
                this.next.handleMouseDrag(grid, event);
            }
        },

        setColumnWidth: function(grid, columnIndex, width) {
            var fixedColumnCount = grid.getFixedColumnCount();
            var scrollLeft = grid.getHScrollValue();
            if (columnIndex < 0) {
                grid.setFixedColumnWidth(fixedColumnCount + columnIndex, width);
            } else {
                grid.setColumnWidth(columnIndex + scrollLeft, width);
            }
        },

        getColumnWidth: function(grid, columnIndex) {
            var fixedColumnCount = grid.getFixedColumnCount();
            if (columnIndex < 0) {
                return grid.getFixedColumnWidth(fixedColumnCount + columnIndex);
            } else {
                return grid.getColumnWidth(columnIndex);
            }
        },

        handleMouseDown: function(grid, event) {
            var gridCell = event.gridCell;
            var overCol = grid.overColumnDivider(event);
            if (overCol > -1 && gridCell.y < grid.getFixedRowCount()) {
                var scrollLeft = grid.getHScrollValue();
                var fixedColumnCount = grid.getFixedColumnCount();
                this.dragColumn = overCol;
                this.dragStart = event.primitiveEvent.detail.mouse.x;
                if (overCol < 2) {
                    scrollLeft = 0;
                }
                this.dragColumnStartingWidth = this.getColumnWidth(grid, overCol - fixedColumnCount - 1 + scrollLeft);
                this.detachChain();
            } else if (this.next) {
                this.next.handleMouseDown(grid, event);
            }
        },

        handleMouseUp: function(grid, event) {
            if (this.dragColumn > -1) {
                this.cursor = null;
                this.dragColumn = -1;

                //delay here to give other events a chance to be dropped
                var self = this;
                setTimeout(function(){
                    self.attachChain();
                }, 200);
            } else if (this.next) {
                this.next.handleMouseUp(grid, event);
            }
        },

        handleMouseMove: function(grid, event) {
            if (this.dragColumn > -1) {
                return;
            }
            this.cursor = null;
            if (this.next) {
                this.next.handleMouseMove(grid, event);
            }
            this.checkForColumnResizeCursorChange(grid, event)
        },

        checkForColumnResizeCursorChange: function(grid, event) {

            var gridCell = event.gridCell;

            if (this.isFixedRow(grid, event) && grid.overColumnDivider(event) > -1) {
                this.cursor = 'col-resize';
            } else {
                this.cursor = null;
            }

        },
    });

})(); /* jshint ignore:line */

  </script>
</polymer-element>
