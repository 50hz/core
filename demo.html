<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>fin-hypergrid Demo</title>

  <script src="../webcomponentsjs/webcomponents.js"></script>
  <link rel="import" href="../paper-tabs/paper-tabs.html">
  <link rel="import" href="../core-pages/core-pages.html">
  <link rel="import" href="../core-splitter/core-splitter.html">

  <link rel="import" href="fin-hypergrid.html">
  <style>
    fin-hypergrid {

    }
    paper-tabs {
        background-color: #E91E63;
        color: #fff;
        box-shadow: 0px 3px 2px rgba(0, 0, 0, 0.2);
    }
    core-header-panel {
        height: 100%;
        width: 100%;
        position: absolute;
    }
    core-pages {
        position: absolute;
        top: 50px;
        right: 0;
        bottom: 0;
        left: 0;
    }
    .abs {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
    }
    .rel {
        position: relative;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
    }
    .description {
        padding-left: 8%;
        padding-right: 8%;
    }
  </style>
</head>
<body unresolved fullbleed>
  <core-header-panel>

    <core-toolbar>
        <paper-tabs selected="0">
            <paper-tab>Default</paper-tab>
            <paper-tab>In Memory</paper-tab>
            <paper-tab>JSON</paper-tab>
            <paper-tab>Q</paper-tab>
        </paper-tabs>
    </core-toolbar>

  <core-pages selected="0">

        <div vertical layout>
          <div class="description">
            <h3>fin-hypergrid-behavior-default</h3> This element is a custom Polymer web component that is the base class for the GridBehavior role in the design of the OpenFin hypergrid.  Not only does it accomodate the interface getValue(x,y) and setValue(x,y) of a traditional table model, it encapsulates the behavior that allows its implementation to determine what happens on various user events. This allows for external data analytics tools to do sorting, drilling down, aggregation etc.  The default behavior is to just return a string of the passed in x and y coordinates.
            <br>
            <br>
          </div>
          <core-splitter direction="up"></core-splitter>
          <div flex class="rel">
            <fin-hypergrid class="abs">
                <fin-hypergrid-behavior-default></fin-hypergrid-behavior-default>
            </fin-hypergrid>
          </div>
        </div>

        <div vertical layout>
          <div class="description">
            <h3>fin-hypergrid-behavior-in-memory</h3> This element is a custom Polymer web component that is a demonstration of a simple subclass of the fin-hypergrid-behavior-default.  It demonstrates live high frequency updating of data, variable width columns, alternate cell renderers, and alternate cell editors(double click in various cells of column 'J').
            <br>
            <br>
          </div>
          <core-splitter direction="up"></core-splitter>
          <div flex class="rel">
            <fin-hypergrid class="abs">
                <fin-hypergrid-behavior-in-memory></fin-hypergrid-behavior-in-memory>
            </fin-hypergrid>
          </div>
        </div>

        <div vertical layout>
          <div class="description">
            <h3>fin-hypergrid-behavior-json</h3> This element is a custom Polymer web component that manages small(<~10000 rows) and simple data sets all within javascript.  The data is "pushed" into the behavior object with the call to setData at anytime after the polymer ready event is fired, see documention for details.
            <br>
            <br>
          </div>
          <core-splitter direction="up"></core-splitter>
          <div flex class="rel">
            <fin-hypergrid class="abs" id="json-example">
                <fin-hypergrid-behavior-json></fin-hypergrid-behavior-json>
            </fin-hypergrid>
          </div>
        </div>

        <div vertical layout>
          <div class="description">
            <h3>fin-hypergrid-behavior-q</h3> This element is a custom Polymer web component that demonstrates a simple interface to Q/KDB+ by kx systems.  In order for this to work you need to run either sorttable.q or bigtable.q scripts on localhost.  Both of these are found in the root directory of this project.  The bigtable.q script simulates a billion row table and cannot be sorted in realtime.  The sorttable.q script is a true in memory million row table that allows you to sort on any column in realtime.
            <br>
            <br>
          </div>
          <core-splitter direction="up"></core-splitter>
          <div flex class="rel">
            <fin-hypergrid class="abs">
                <fin-hypergrid-behavior-q></fin-hypergrid-behavior-q>
            </fin-hypergrid>
          </div>
        </div>

  </core-pages>


  </core-header-panel>

  <script>
    //lets initialize the tabs....
    (function() {
        var tabs = document.querySelector('paper-tabs');
        var pages = document.querySelector('core-pages');
        tabs.addEventListener('core-select', function() {
            pages.selected = tabs.selected;
        });
    })();

    //setup random data for the JSON tab example
    (function(){

        var numRows = 5000;

        var firstNames = ['Olivia', 'Sophia', 'Ava', 'Isabella', 'Boy', 'Liam', 'Noah', 'Ethan', 'Mason', 'Logan', 'Moe', 'Larry', 'Curly', 'Shemp', 'Groucho', 'Harpo', 'Chico', 'Zeppo', 'Stanley', 'Hardy'];
        var lastNames = ['Wirts', 'Oneil', 'Smith', 'Barbarosa', 'Soprano', 'Gotti', 'Columbo', 'Luciano', 'Doerre', 'DePena'];
        var months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
        var days = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30'];
        var states = ['Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','Florida','Georgia','Hawaii','Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky','Louisiana','Maine','Maryland','Massachusetts','Michigan','Minnesota','Mississippi','Missouri','Montana','Nebraska','Nevada','New Hampshire','New Jersey','New Mexico','New York','North Carolina','North Dakota','Ohio','Oklahoma','Oregon','Pennsylvania','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Vermont','Virginia','Washington','West Virginia','Wisconsin','Wyoming'];

        var randomPerson = function() {
            var firstName = Math.round((firstNames.length - 1) * Math.random());
            var lastName = Math.round((lastNames.length - 1) * Math.random());
            var pets = Math.round(10 * Math.random());
            var birthyear = 1900 + Math.round(Math.random() * 114);
            var birthmonth = Math.round(Math.random() * 11);
            var birthday = Math.round(Math.random() * 29);
            var birthstate = Math.round(Math.random() * 49);
            var residencestate = Math.round(Math.random() * 49);
            var score = Math.round(Math.random() * 1000000)/1000;
            var income = Math.round(Math.random() * 10000000)/100;
            var employed = Math.round(Math.random());
            var person = {
                last: lastNames[lastName],
                first: firstNames[firstName],
                pets: pets,
                birthdate: birthyear + '-' + months[birthmonth] + '-' + days[birthday],
                birthstate: states[birthstate],
                residencestate: states[residencestate],
                employed: employed === 1,
                income: income,
                score: score
            };
            return person;
        };

       var headers =
            [
                'last',
                'first',
                'pets',
                'birth date',
                'birth state',
                'residence state',
                'employed',
                'income',
                'score'
            ];

        var fields =
            [
                'last',
                'first',
                'pets',
                'birthdate',
                'birthstate',
                'residencestate',
                'employed',
                'income',
                'score'
            ];

        var data = [];
        for (var i = 0; i < numRows; i ++) {
            data.push(randomPerson());
        }

        var editorTypes = ['choice','textfield','spinner','date','choice','choice','choice','textfield','textfield'];

        document.addEventListener('polymer-ready', function() {

            //get ahold of our json grid example
            var jsonGrid = document.querySelector('#json-example');

            //get it's table model
            var jsonModel = jsonGrid.getBehavior();

            //get the cell cellProvider for altering cell renderers
            var cellProvider = jsonModel.getCellProvider();

            //set the header labels
            jsonModel.setHeaders(headers);

            //set the fields found on the row objects
            jsonModel.setFields(fields);

            //set the actual json row objects
            jsonModel.setData(data);

            //sort ascending on the first column (first name)
            jsonModel.toggleSort(0);

            //all formatting and rendering per cell can be overridden in here
            cellProvider.getCell = function(config) {
                var renderer = cellProvider.cellCache.simpleCellRenderer;
                config.halign = 'left';
                var x = config.x;
                if (x === 2) {
                    config.halign = 'center';
                } else if (x === 3) {
                    config.halign = 'center';
                } else if (x === 6) {
                    config.halign = 'center';
                } else if (x === 7) {
                    var score = 60 + Math.round(config.value*150/100000);
                    var bcolor = score.toString(16);
                    config.halign = 'right';
                    config.bgColor = '#00' + bcolor + '00';
                    config.fgColor = '#FFFFFF';
                } else if (x === 8) {
                    var score = 105 + Math.round(config.value*150/1000);
                    var bcolor = score.toString(16);
                    config.halign = 'right';
                    config.bgColor = '#' + bcolor+ '0000';
                    config.fgColor = '#FFFFFF';
                }

                renderer.config = config;
                return renderer;
            };

            //lets override the cell editors, and configure the drop down lists
            jsonModel.getCellEditorAt = function(x, y) {
                var type = editorTypes[x];
                var cellEditor = this.grid.cellEditors[type];
                if (x === 0) {
                    cellEditor.items = lastNames;
                } else if (x === 4 || x === 5) {
                    cellEditor.items = states;
                } else if (x === 6) {
                    cellEditor.items = [true, false];
                }
                return cellEditor;
            };

        });

    })();
  </script>

</body>
</html>
